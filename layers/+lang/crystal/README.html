<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-01-22 Sun 17:10 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>crystal layer</title>
<meta name="author" content="root" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css"
                 href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
          <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
          <script src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
          <script>

          // Add permalinks to the documentation headings
          $(document).ready(function() {
              [".outline-2 h2", ".outline-3 h3", ".outline-4 h4", ".outline-5 h5"].forEach(function(i) {
                  $(i).each(function() {
                          var page_url = window.location.pathname;
                          var node = $(this).attr("id");
                          var full_url = page_url + "#" + node;
                          $(this).contents().last().after('<span id="permalink"><a href="'
                                                          + full_url + '">¶</a></span>');
                  });
              });
          });
          </script>
<link rel="stylesheet" type="text/css" href="../../../css/readtheorg.css" />
</head>
<body>
<div id="content" class="content">
<div id="toggle-sidebar"><a href="#table-of-contents"><h2>Table of Contents</h2></a></div>
<h1 class="title">crystal layer</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents<a href="#">Close</a></h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#description">1. Description</a>
<ul>
<li><a href="#features">1.1. Features:</a></li>
</ul>
</li>
<li><a href="#install">2. Install</a></li>
<li><a href="#configuration">3. Configuration</a>
<ul>
<li><a href="#choosing-a-backend">3.1. Choosing a backend</a>
<ul>
<li><a href="#company-crystal">3.1.1. Company-crystal</a></li>
<li><a href="#lsp">3.1.2. LSP</a></li>
</ul>
</li>
<li><a href="#repl">3.2. REPL</a></li>
<li><a href="#ameba">3.3. Ameba</a></li>
</ul>
</li>
<li><a href="#key-bindings">4. Key bindings</a>
<ul>
<li><a href="#crystal-commands">4.1. Crystal commands</a></li>
<li><a href="#repl-1">4.2. REPL</a></li>
<li><a href="#ameba-1">4.3. Ameba</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="org79b45a2" class="figure">
<p><img src="img/crystal.png" alt="crystal.png" />
</p>
</div>

<div id="outline-container-description" class="outline-2">
<h2 id="description"><span class="section-number-2">1.</span> Description</h2>
<div class="outline-text-2" id="text-description">
<p>
This layer provides support for the Crystal language.
</p>
</div>

<div id="outline-container-features" class="outline-3">
<h3 id="features"><span class="section-number-3">1.1.</span> Features:</h3>
<div class="outline-text-3" id="text-features">
<ul class="org-ul">
<li>Format on save</li>
<li>Integration of <a href="https://play.crystal-lang.org">play.crystal-lang.org</a> using <a href="https://github.com/veelenga/play-crystal.el">play-crystal.el</a></li>
<li>Syntax checking</li>
<li>Auto completion</li>
<li>Test execution (<code>crystal spec</code>)</li>
<li><code>crystal tool</code> integration</li>
<li>Interactive REPL (<a href="https://github.com/brantou/inf-crystal.el">inf-crystal.el</a> and <a href="https://github.com/crystal-community/icr">icr</a>)</li>
<li>Static code analysis using <a href="https://github.com/veelenga/ameba.el">ameba</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-install" class="outline-2">
<h2 id="install"><span class="section-number-2">2.</span> Install</h2>
<div class="outline-text-2" id="text-install">
<p>
To use this configuration layer, add it to your <code>~/.spacemacs</code>. You will need to
add <code>crystal</code> to the existing <code>dotspacemacs-configuration-layers</code> list in this
file.
</p>
</div>
</div>

<div id="outline-container-configuration" class="outline-2">
<h2 id="configuration"><span class="section-number-2">3.</span> Configuration</h2>
<div class="outline-text-2" id="text-configuration">
<p>
All layer configurations can be done by setting layer variables in your dotfile.
No custom user config lines are necessary
</p>
</div>

<div id="outline-container-choosing-a-backend" class="outline-3">
<h3 id="choosing-a-backend"><span class="section-number-3">3.1.</span> Choosing a backend</h3>
<div class="outline-text-3" id="text-choosing-a-backend">
<p>
This layer provides two alternative backends to choose from.
</p>
</div>

<div id="outline-container-company-crystal" class="outline-4">
<h4 id="company-crystal"><span class="section-number-4">3.1.1.</span> Company-crystal</h4>
<div class="outline-text-4" id="text-company-crystal">
<p>
This is the default choice if nothing is set and no lsp layer
is loaded in your dotfile. This mode only provides very
limited IDE capabilities. Used best if only small files
are edited. To set explicitly set the following in your
dotfile:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>crystal <span class="org-builtin">:variables</span> crystal-backend 'company-crystal<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-lsp" class="outline-4">
<h4 id="lsp"><span class="section-number-4">3.1.2.</span> LSP</h4>
<div class="outline-text-4" id="text-lsp">
<p>
For proper IDE support this backend should be used. It is
based on an external server which will be started automatically
by emacs, once a crystal file is opened. The key bindings are
the same for all lsp modes so if you are already familiar with
one you should be able to work the same in all modes.
</p>

<p>
To set explicitly do the following in your dotfile:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>crystal <span class="org-builtin">:variables</span>
         crystal-backend 'lsp<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
For this to work you will also need to obtain
the latest version of the lsp server from <a href="https://github.com/crystal-lang-tools/scry#installation">here</a>.
</p>

<p>
NOTE: Key bindings for LSP are defined in the
LSP layer. Also it is advisable to have a look
at the autocomplete layer for an optimal
intellisense config for LSP.
</p>
</div>
</div>
</div>

<div id="outline-container-repl" class="outline-3">
<h3 id="repl"><span class="section-number-3">3.2.</span> REPL</h3>
<div class="outline-text-3" id="text-repl">
<p>
To be able to connect to <a href="https://github.com/brantou/inf-crystal.el">inf-crystal</a>, you need to make sure that <a href="https://github.com/crystal-community/icr">icr</a> is
installed.
</p>

<p>
Installation instructions can be found on the main page of <a href="https://github.com/crystal-community/icr#installation">icr</a>.
</p>

<p>
Although not in the installation instruction it seems that on macOS you can
install it with Homebrew:
</p>

<div class="org-src-container">
<pre class="src src-sh">brew install crystal-icr
</pre>
</div>
</div>
</div>

<div id="outline-container-ameba" class="outline-3">
<h3 id="ameba"><span class="section-number-3">3.3.</span> Ameba</h3>
<div class="outline-text-3" id="text-ameba">
<p>
To be able to use <a href="https://github.com/veelenga/ameba.el">ameba.el</a>, you need to make sure that <a href="https://github.com/veelenga/ameba">ameba</a> is installed.
</p>

<p>
Installation instructions can be found on the main page of <a href="https://github.com/veelenga/ameba">ameba</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-key-bindings" class="outline-2">
<h2 id="key-bindings"><span class="section-number-2">4.</span> Key bindings</h2>
<div class="outline-text-2" id="text-key-bindings">
</div>

<div id="outline-container-crystal-commands" class="outline-3">
<h3 id="crystal-commands"><span class="section-number-3">4.1.</span> Crystal commands</h3>
<div class="outline-text-3" id="text-crystal-commands">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Key binding</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>SPC m e b</code></td>
<td class="org-left">play-crystal submit buffer</td>
</tr>

<tr>
<td class="org-left"><code>SPC m e e</code></td>
<td class="org-left">play-crystal show code in a browser</td>
</tr>

<tr>
<td class="org-left"><code>SPC m e i</code></td>
<td class="org-left">download play-crystal snippet</td>
</tr>

<tr>
<td class="org-left"><code>SPC m e r</code></td>
<td class="org-left">play-crystal submit region</td>
</tr>

<tr>
<td class="org-left"><code>SPC m g G</code></td>
<td class="org-left">jump to definition in other window</td>
</tr>

<tr>
<td class="org-left"><code>SPC m g a</code></td>
<td class="org-left">jump to matching spec file or back from spec to code file</td>
</tr>

<tr>
<td class="org-left"><code>SPC m g g</code></td>
<td class="org-left">jump to definition</td>
</tr>

<tr>
<td class="org-left"><code>SPC m t b</code></td>
<td class="org-left">run <code>crystal spec</code> for the current buffer</td>
</tr>

<tr>
<td class="org-left"><code>SPC m t p</code></td>
<td class="org-left">run <code>crystal spec</code> for the current project</td>
</tr>

<tr>
<td class="org-left"><code>SPC m u c</code></td>
<td class="org-left">show context</td>
</tr>

<tr>
<td class="org-left"><code>SPC m u e</code></td>
<td class="org-left">show macro expansion</td>
</tr>

<tr>
<td class="org-left"><code>SPC m u f</code></td>
<td class="org-left">format the current buffer</td>
</tr>

<tr>
<td class="org-left"><code>SPC m u i</code></td>
<td class="org-left">show implementations for given call</td>
</tr>

<tr>
<td class="org-left"><code>SPC m a x</code></td>
<td class="org-left">run <code>crystal run</code> for the current file</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-repl-1" class="outline-3">
<h3 id="repl-1"><span class="section-number-3">4.2.</span> REPL</h3>
<div class="outline-text-3" id="text-repl-1">
<p>
Start a inferior crystal REPL process with <code>SPC m '​~ or ~SPC m s i</code>.
Then you can send code to it with the bindings below:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Key binding</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">~SPC m '​~</td>
<td class="org-left">start inferior REPL process</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s B</code></td>
<td class="org-left">send buffer and switch to REPL</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s F</code></td>
<td class="org-left">send function definition and switch to REPL</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s R</code></td>
<td class="org-left">send region and switch to REPL</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s b</code></td>
<td class="org-left">send buffer</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s f</code></td>
<td class="org-left">send function definition</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s i</code></td>
<td class="org-left">start inferior REPL process</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s r</code></td>
<td class="org-left">send region</td>
</tr>

<tr>
<td class="org-left"><code>SPC m s s</code></td>
<td class="org-left">switch to REPL</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-ameba-1" class="outline-3">
<h3 id="ameba-1"><span class="section-number-3">4.3.</span> Ameba</h3>
<div class="outline-text-3" id="text-ameba-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Key binding</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>SPC m u a d</code></td>
<td class="org-left">Prompts from a directory on which to run Ameba</td>
</tr>

<tr>
<td class="org-left"><code>SPC m u a f</code></td>
<td class="org-left">Runs Ameba on the current visited file</td>
</tr>

<tr>
<td class="org-left"><code>SPC m u a p</code></td>
<td class="org-left">Runs Ameba on the entire project</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: root</p>
<p class="date">Created: 2023-01-22 Sun 17:10</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>